<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 11/22 重點回顧 | Youtube Influencers Trending Model</title>
  <meta name="description" content="4 11/22 重點回顧 | Youtube Influencers Trending Model" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="4 11/22 重點回顧 | Youtube Influencers Trending Model" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="Liam-TW/your-repo-name" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 11/22 重點回顧 | Youtube Influencers Trending Model" />
  
  
  

<meta name="author" content="Liam Chen" />


<meta name="date" content="2024-11-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="next-step.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this project</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#研究背景與目的"><i class="fa fa-check"></i><b>1.1</b> 研究背景與目的</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#研究方法"><i class="fa fa-check"></i><b>1.2</b> 研究方法</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#資料收集"><i class="fa fa-check"></i><b>1.2.1</b> 資料收集</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#變項選擇"><i class="fa fa-check"></i><b>1.2.2</b> 變項選擇</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#數據分析"><i class="fa fa-check"></i><b>1.2.3</b> 數據分析</a></li>
<li class="chapter" data-level="1.2.4" data-path="index.html"><a href="index.html#個案分析"><i class="fa fa-check"></i><b>1.2.4</b> 個案分析</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#研究結果與討論"><i class="fa fa-check"></i><b>1.3</b> 研究結果與討論</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#與網紅合作的影片類型"><i class="fa fa-check"></i><b>1.3.1</b> 與網紅合作的影片類型</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#內部團隊製作的影片類型"><i class="fa fa-check"></i><b>1.3.2</b> 內部團隊製作的影片類型</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#結論與實務建議"><i class="fa fa-check"></i><b>1.4</b> 結論與實務建議</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#參考文獻"><i class="fa fa-check"></i><b>1.5</b> 參考文獻</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html"><i class="fa fa-check"></i><b>2</b> Text Mining of Youtube Comments</a>
<ul>
<li class="chapter" data-level="2.1" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#準備-r-python-環境"><i class="fa fa-check"></i><b>2.1</b> 準備 R + Python 環境</a></li>
<li class="chapter" data-level="2.2" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#建置-dataset"><i class="fa fa-check"></i><b>2.2</b> 建置 Dataset</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#by-api-尋找影片標籤"><i class="fa fa-check"></i><b>2.2.1</b> By API 尋找影片標籤</a></li>
<li class="chapter" data-level="2.2.2" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#by-api-查找符合條件的-url-清單"><i class="fa fa-check"></i><b>2.2.2</b> By API 查找符合條件的 url 清單</a></li>
<li class="chapter" data-level="2.2.3" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#爬取留言"><i class="fa fa-check"></i><b>2.2.3</b> 爬取留言</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#文字探勘分析"><i class="fa fa-check"></i><b>2.3</b> 文字探勘分析</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#套件準備"><i class="fa fa-check"></i><b>2.3.1</b> 套件準備</a></li>
<li class="chapter" data-level="2.3.2" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#文本清理"><i class="fa fa-check"></i><b>2.3.2</b> 文本清理</a></li>
<li class="chapter" data-level="2.3.3" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#case-1-詞頻文字雲"><i class="fa fa-check"></i><b>2.3.3</b> Case 1 詞頻&amp;文字雲</a></li>
<li class="chapter" data-level="2.3.4" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#case-2-情感分析"><i class="fa fa-check"></i><b>2.3.4</b> Case 2 情感分析</a></li>
<li class="chapter" data-level="2.3.5" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#case-3-主題模型"><i class="fa fa-check"></i><b>2.3.5</b> Case 3 主題模型</a></li>
<li class="chapter" data-level="2.3.6" data-path="text-mining-of-youtube-comments.html"><a href="text-mining-of-youtube-comments.html#case-4-詞性標注"><i class="fa fa-check"></i><b>2.3.6</b> Case 4 詞性標注</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="next-step.html"><a href="next-step.html"><i class="fa fa-check"></i><b>3</b> Next Step?</a></li>
<li class="chapter" data-level="4" data-path="重點回顧.html"><a href="重點回顧.html"><i class="fa fa-check"></i><b>4</b> 11/22 重點回顧</a>
<ul>
<li class="chapter" data-level="4.1" data-path="重點回顧.html"><a href="重點回顧.html#刪除非英文評論"><i class="fa fa-check"></i><b>4.1</b> 刪除非英文評論</a></li>
<li class="chapter" data-level="4.2" data-path="重點回顧.html"><a href="重點回顧.html#文本重清理"><i class="fa fa-check"></i><b>4.2</b> 文本重清理</a></li>
<li class="chapter" data-level="4.3" data-path="重點回顧.html"><a href="重點回顧.html#變數修正時間按讚數"><i class="fa fa-check"></i><b>4.3</b> 變數修正（時間&amp;按讚數）</a></li>
<li class="chapter" data-level="4.4" data-path="重點回顧.html"><a href="重點回顧.html#轉換寬格式的必要"><i class="fa fa-check"></i><b>4.4</b> 轉換寬格式的必要？</a></li>
<li class="chapter" data-level="4.5" data-path="重點回顧.html"><a href="重點回顧.html#ml-model-selection"><i class="fa fa-check"></i><b>4.5</b> ML model selection</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Youtube Influencers Trending Model</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="重點回顧" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> 11/22 重點回顧<a href="重點回顧.html#重點回顧" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="刪除非英文評論" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> 刪除非英文評論<a href="重點回顧.html#刪除非英文評論" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="重點回顧.html#cb1-1" tabindex="-1"></a><span class="co"># 讀取資料</span></span>
<span id="cb1-2"><a href="重點回顧.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="重點回顧.html#cb1-3" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;/Users/liam/Desktop/NTNU/碩二/1131/文字探勘/youtube_comments_with_likes_1114.csv&quot;</span>)</span>
<span id="cb1-4"><a href="重點回顧.html#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="重點回顧.html#cb1-5" tabindex="-1"></a><span class="co"># 使用正則表達式檢測僅包含英語字母、數字和標點的評論</span></span>
<span id="cb1-6"><a href="重點回顧.html#cb1-6" tabindex="-1"></a>data_clean <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="重點回顧.html#cb1-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comment =</span> <span class="fu">as.character</span>(comment)) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="重點回顧.html#cb1-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;^[A-Za-z0-9</span><span class="sc">\\</span><span class="st">s.,!?</span><span class="sc">\\</span><span class="st">&#39;</span><span class="sc">\&quot;</span><span class="st">-]+$&quot;</span>, comment))</span>
<span id="cb1-9"><a href="重點回顧.html#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="重點回顧.html#cb1-10" tabindex="-1"></a><span class="co"># 保存清理後的結果</span></span>
<span id="cb1-11"><a href="重點回顧.html#cb1-11" tabindex="-1"></a><span class="fu">write.csv</span>(data_clean, <span class="st">&quot;cleaned_youtube_comments.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-12"><a href="重點回顧.html#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="重點回顧.html#cb1-13" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;清理完成，剩餘&quot;</span>, <span class="fu">nrow</span>(data_clean), <span class="st">&quot;條英語系評論。</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-14"><a href="重點回顧.html#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="重點回顧.html#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="重點回顧.html#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="重點回顧.html#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="重點回顧.html#cb1-18" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;textcat&quot;</span>)</span>
<span id="cb1-19"><a href="重點回顧.html#cb1-19" tabindex="-1"></a></span>
<span id="cb1-20"><a href="重點回顧.html#cb1-20" tabindex="-1"></a><span class="co"># 讀取資料並檢測語言</span></span>
<span id="cb1-21"><a href="重點回顧.html#cb1-21" tabindex="-1"></a><span class="fu">library</span>(textcat)</span>
<span id="cb1-22"><a href="重點回顧.html#cb1-22" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;/Users/liam/Desktop/NTNU/碩二/1131/文字探勘/youtube_comments_with_likes_1114.csv&quot;</span>)</span>
<span id="cb1-23"><a href="重點回顧.html#cb1-23" tabindex="-1"></a></span>
<span id="cb1-24"><a href="重點回顧.html#cb1-24" tabindex="-1"></a><span class="co"># 檢測評論語言</span></span>
<span id="cb1-25"><a href="重點回顧.html#cb1-25" tabindex="-1"></a>data_clean <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb1-26"><a href="重點回顧.html#cb1-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comment =</span> <span class="fu">as.character</span>(comment),</span>
<span id="cb1-27"><a href="重點回顧.html#cb1-27" tabindex="-1"></a>         <span class="at">language =</span> <span class="fu">textcat</span>(comment)) <span class="sc">%&gt;%</span></span>
<span id="cb1-28"><a href="重點回顧.html#cb1-28" tabindex="-1"></a>  <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">&quot;english&quot;</span>)  <span class="co"># 過濾僅包含英語的評論</span></span>
<span id="cb1-29"><a href="重點回顧.html#cb1-29" tabindex="-1"></a></span>
<span id="cb1-30"><a href="重點回顧.html#cb1-30" tabindex="-1"></a><span class="co"># 保存清理後的結果</span></span>
<span id="cb1-31"><a href="重點回顧.html#cb1-31" tabindex="-1"></a><span class="fu">write.csv</span>(data_clean, <span class="st">&quot;cleaned_youtube_comments_t2.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-32"><a href="重點回顧.html#cb1-32" tabindex="-1"></a></span>
<span id="cb1-33"><a href="重點回顧.html#cb1-33" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;清理完成，剩餘&quot;</span>, <span class="fu">nrow</span>(data_clean), <span class="st">&quot;條英語系評論。</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
<div id="文本重清理" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> 文本重清理<a href="重點回顧.html#文本重清理" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="重點回顧.html#cb2-1" tabindex="-1"></a><span class="do">## 加載套件</span></span>
<span id="cb2-2"><a href="重點回顧.html#cb2-2" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb2-3"><a href="重點回顧.html#cb2-3" tabindex="-1"></a><span class="fu">library</span>(SnowballC)</span>
<span id="cb2-4"><a href="重點回顧.html#cb2-4" tabindex="-1"></a><span class="fu">library</span>(jiebaR) <span class="co"># 用於中文分詞</span></span>
<span id="cb2-5"><a href="重點回顧.html#cb2-5" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb2-6"><a href="重點回顧.html#cb2-6" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-7"><a href="重點回顧.html#cb2-7" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-8"><a href="重點回顧.html#cb2-8" tabindex="-1"></a><span class="fu">library</span>(textstem)</span>
<span id="cb2-9"><a href="重點回顧.html#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="重點回顧.html#cb2-10" tabindex="-1"></a><span class="co"># 讀取 CSV 文件</span></span>
<span id="cb2-11"><a href="重點回顧.html#cb2-11" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="st">&quot;/Users/liam/Desktop/NTNU/碩二/1131/文字探勘/cleaned_youtube_comments_t2.csv&quot;</span></span>
<span id="cb2-12"><a href="重點回顧.html#cb2-12" tabindex="-1"></a>comments_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb2-13"><a href="重點回顧.html#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="重點回顧.html#cb2-14" tabindex="-1"></a><span class="co"># 假設你的 CSV 包含 &#39;comment&#39; 和 &#39;views&#39; 列</span></span>
<span id="cb2-15"><a href="重點回顧.html#cb2-15" tabindex="-1"></a><span class="co"># 增加 line 編號作為每條評論的唯一標識</span></span>
<span id="cb2-16"><a href="重點回顧.html#cb2-16" tabindex="-1"></a>comments_df <span class="ot">&lt;-</span> comments_df <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="重點回顧.html#cb2-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">line =</span> <span class="fu">row_number</span>())</span>
<span id="cb2-18"><a href="重點回顧.html#cb2-18" tabindex="-1"></a></span>
<span id="cb2-19"><a href="重點回顧.html#cb2-19" tabindex="-1"></a><span class="co"># 清理文本</span></span>
<span id="cb2-20"><a href="重點回顧.html#cb2-20" tabindex="-1"></a>comments_df<span class="sc">$</span>text <span class="ot">&lt;-</span> <span class="fu">tolower</span>(comments_df<span class="sc">$</span>comment)  <span class="co"># 轉換為小寫</span></span>
<span id="cb2-21"><a href="重點回顧.html#cb2-21" tabindex="-1"></a>comments_df<span class="sc">$</span>text <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>, <span class="st">&quot; &quot;</span>, comments_df<span class="sc">$</span>text)  <span class="co"># 移除標點符號</span></span>
<span id="cb2-22"><a href="重點回顧.html#cb2-22" tabindex="-1"></a>comments_df<span class="sc">$</span>text <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[[:digit:]]&quot;</span>, <span class="st">&quot; &quot;</span>, comments_df<span class="sc">$</span>text)  <span class="co"># 移除數字</span></span>
<span id="cb2-23"><a href="重點回顧.html#cb2-23" tabindex="-1"></a>comments_df<span class="sc">$</span>text <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+&quot;</span>, <span class="st">&quot; &quot;</span>, comments_df<span class="sc">$</span>text)  <span class="co"># 移除多餘空白</span></span>
<span id="cb2-24"><a href="重點回顧.html#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="重點回顧.html#cb2-25" tabindex="-1"></a><span class="co"># 將評論拆分為單詞並保留 line 和 views 信息</span></span>
<span id="cb2-26"><a href="重點回顧.html#cb2-26" tabindex="-1"></a>wordfile <span class="ot">&lt;-</span> comments_df <span class="sc">%&gt;%</span></span>
<span id="cb2-27"><a href="重點回顧.html#cb2-27" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, <span class="at">token =</span> <span class="st">&quot;words&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-28"><a href="重點回顧.html#cb2-28" tabindex="-1"></a>  <span class="fu">select</span>(line, word, views, timestamp, likes)</span>
<span id="cb2-29"><a href="重點回顧.html#cb2-29" tabindex="-1"></a></span>
<span id="cb2-30"><a href="重點回顧.html#cb2-30" tabindex="-1"></a></span>
<span id="cb2-31"><a href="重點回顧.html#cb2-31" tabindex="-1"></a><span class="co"># 加載標準停用詞列表</span></span>
<span id="cb2-32"><a href="重點回顧.html#cb2-32" tabindex="-1"></a>stop_words <span class="ot">&lt;-</span> tidytext<span class="sc">::</span>stop_words</span>
<span id="cb2-33"><a href="重點回顧.html#cb2-33" tabindex="-1"></a></span>
<span id="cb2-34"><a href="重點回顧.html#cb2-34" tabindex="-1"></a><span class="co"># 移除停用詞</span></span>
<span id="cb2-35"><a href="重點回顧.html#cb2-35" tabindex="-1"></a>wordfile <span class="ot">&lt;-</span> wordfile <span class="sc">%&gt;%</span></span>
<span id="cb2-36"><a href="重點回顧.html#cb2-36" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">&quot;word&quot;</span>)</span>
<span id="cb2-37"><a href="重點回顧.html#cb2-37" tabindex="-1"></a></span>
<span id="cb2-38"><a href="重點回顧.html#cb2-38" tabindex="-1"></a><span class="co"># 擴展停用詞列表，加入縮寫詞和口語詞</span></span>
<span id="cb2-39"><a href="重點回顧.html#cb2-39" tabindex="-1"></a>custom_stop_words <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">word =</span> <span class="fu">c</span>(<span class="st">&quot;hai&quot;</span>,<span class="st">&quot;bhai&quot;</span>,<span class="st">&quot;don&quot;</span>,<span class="st">&quot;music&quot;</span>,<span class="st">&quot;listen&quot;</span>,</span>
<span id="cb2-40"><a href="重點回顧.html#cb2-40" tabindex="-1"></a>                                         <span class="st">&quot;song&quot;</span>,<span class="st">&quot;ina&quot;</span>,<span class="st">&quot;video&quot;</span>,<span class="st">&quot;watch&quot;</span>,<span class="st">&quot;day&quot;</span>,</span>
<span id="cb2-41"><a href="重點回顧.html#cb2-41" tabindex="-1"></a>                                         <span class="st">&quot;edit&quot;</span>,</span>
<span id="cb2-42"><a href="重點回顧.html#cb2-42" tabindex="-1"></a>                                         <span class="st">&quot;ve&quot;</span>, <span class="st">&quot;ll&quot;</span>, <span class="st">&quot;na&quot;</span>, <span class="st">&quot;el&quot;</span>, </span>
<span id="cb2-43"><a href="重點回顧.html#cb2-43" tabindex="-1"></a>                                         <span class="st">&quot;la&quot;</span>, <span class="st">&quot;️️️&quot;</span>, <span class="st">&quot;’ll&quot;</span>, <span class="st">&quot;‘till</span></span>
<span id="cb2-44"><a href="重點回顧.html#cb2-44" tabindex="-1"></a><span class="st">                                         &quot;</span>, <span class="st">&quot;’ve&quot;</span>, <span class="st">&quot;‘littl&quot;</span>, <span class="st">&quot;’re&quot;</span>, </span>
<span id="cb2-45"><a href="重點回顧.html#cb2-45" tabindex="-1"></a>                                         <span class="st">&quot;“’m&quot;</span>, <span class="st">&quot;“’re&quot;</span>, <span class="st">&quot;“bon&quot;</span>, </span>
<span id="cb2-46"><a href="重點回顧.html#cb2-46" tabindex="-1"></a>                                         <span class="st">&quot;“copi&quot;</span>, <span class="st">&quot;“don’t&quot;</span>,<span class="st">&quot;you&quot;</span>,</span>
<span id="cb2-47"><a href="重點回顧.html#cb2-47" tabindex="-1"></a>                                         <span class="st">&quot;the&quot;</span>, <span class="st">&quot;and&quot;</span>, <span class="st">&quot;you&quot;</span>, <span class="st">&quot;that&quot;</span>, <span class="st">&quot;for&quot;</span>,</span>
<span id="cb2-48"><a href="重點回顧.html#cb2-48" tabindex="-1"></a>                                         <span class="st">&quot;doesn&quot;</span>,<span class="st">&quot;didn&quot;</span>,<span class="st">&quot;facemoji&quot;</span>,<span class="st">&quot;bio&quot;</span>,</span>
<span id="cb2-49"><a href="重點回顧.html#cb2-49" tabindex="-1"></a>                                         <span class="st">&quot;interesrting&quot;</span>,<span class="st">&quot;awesomeeee&quot;</span>,<span class="st">&quot;asome&quot;</span>,</span>
<span id="cb2-50"><a href="重點回顧.html#cb2-50" tabindex="-1"></a>                                         <span class="st">&quot;hardd&quot;</span>,<span class="st">&quot;kocham&quot;</span>,<span class="st">&quot;১ম&quot;</span>,<span class="st">&quot;২০&quot;</span>,<span class="st">&quot;৪০&quot;</span>,<span class="st">&quot;á&quot;</span>,</span>
<span id="cb2-51"><a href="重點回顧.html#cb2-51" tabindex="-1"></a>                                         <span class="st">&quot;aa&quot;</span>,<span class="st">&quot;aaaaaaaaaaahhhhhhhhhhhh&quot;</span>,</span>
<span id="cb2-52"><a href="重點回顧.html#cb2-52" tabindex="-1"></a>                                         <span class="st">&quot;aaaaaaaaaaa&quot;</span>,<span class="st">&quot;aaaaaaaaaa&quot;</span>,<span class="st">&quot;aaaaaaaa&quot;</span>,</span>
<span id="cb2-53"><a href="重點回顧.html#cb2-53" tabindex="-1"></a>                                         <span class="st">&quot;aaa&quot;</span>,<span class="st">&quot;aaaaaah&quot;</span>,<span class="st">&quot;aaaaaand&quot;</span>,<span class="st">&quot;aæaæaæaæaæa&quot;</span>,</span>
<span id="cb2-54"><a href="重點回顧.html#cb2-54" tabindex="-1"></a>                                         <span class="st">&quot;aaj&quot;</span>,<span class="st">&quot;aaliyah&quot;</span>,<span class="st">&quot;aam&quot;</span>,<span class="st">&quot;aani&quot;</span>,<span class="st">&quot;ab&quot;</span>))</span>
<span id="cb2-55"><a href="重點回顧.html#cb2-55" tabindex="-1"></a><span class="co"># 移除自定義的停用詞</span></span>
<span id="cb2-56"><a href="重點回顧.html#cb2-56" tabindex="-1"></a>wordfile <span class="ot">&lt;-</span> wordfile <span class="sc">%&gt;%</span></span>
<span id="cb2-57"><a href="重點回顧.html#cb2-57" tabindex="-1"></a>  <span class="fu">anti_join</span>(custom_stop_words, <span class="at">by =</span> <span class="st">&quot;word&quot;</span>)</span>
<span id="cb2-58"><a href="重點回顧.html#cb2-58" tabindex="-1"></a></span>
<span id="cb2-59"><a href="重點回顧.html#cb2-59" tabindex="-1"></a><span class="co"># 使用 lemmatize_words 進行詞形還原</span></span>
<span id="cb2-60"><a href="重點回顧.html#cb2-60" tabindex="-1"></a>wordfile<span class="sc">$</span>word <span class="ot">&lt;-</span> <span class="fu">lemmatize_words</span>(wordfile<span class="sc">$</span>word)</span>
<span id="cb2-61"><a href="重點回顧.html#cb2-61" tabindex="-1"></a></span>
<span id="cb2-62"><a href="重點回顧.html#cb2-62" tabindex="-1"></a><span class="co"># 移除數字</span></span>
<span id="cb2-63"><a href="重點回顧.html#cb2-63" tabindex="-1"></a>wordfile <span class="ot">&lt;-</span> wordfile <span class="sc">%&gt;%</span></span>
<span id="cb2-64"><a href="重點回顧.html#cb2-64" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">d+&quot;</span>, word))</span>
<span id="cb2-65"><a href="重點回顧.html#cb2-65" tabindex="-1"></a></span>
<span id="cb2-66"><a href="重點回顧.html#cb2-66" tabindex="-1"></a><span class="co"># 重新計算詞頻</span></span>
<span id="cb2-67"><a href="重點回顧.html#cb2-67" tabindex="-1"></a>wordfreq <span class="ot">&lt;-</span> <span class="fu">count</span>(wordfile, word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-68"><a href="重點回顧.html#cb2-68" tabindex="-1"></a></span>
<span id="cb2-69"><a href="重點回顧.html#cb2-69" tabindex="-1"></a><span class="co"># 查看前 20 個最常見的詞</span></span>
<span id="cb2-70"><a href="重點回顧.html#cb2-70" tabindex="-1"></a>wordfreqdf20 <span class="ot">&lt;-</span> wordfreq[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,]</span>
<span id="cb2-71"><a href="重點回顧.html#cb2-71" tabindex="-1"></a><span class="co"># 打印結果</span></span>
<span id="cb2-72"><a href="重點回顧.html#cb2-72" tabindex="-1"></a>wordfreqdf20</span>
<span id="cb2-73"><a href="重點回顧.html#cb2-73" tabindex="-1"></a></span>
<span id="cb2-74"><a href="重點回顧.html#cb2-74" tabindex="-1"></a></span>
<span id="cb2-75"><a href="重點回顧.html#cb2-75" tabindex="-1"></a></span>
<span id="cb2-76"><a href="重點回顧.html#cb2-76" tabindex="-1"></a><span class="co"># 計算 TF-IDF</span></span>
<span id="cb2-77"><a href="重點回顧.html#cb2-77" tabindex="-1"></a>wordfile_with_tfidf <span class="ot">&lt;-</span> wordfile <span class="sc">%&gt;%</span></span>
<span id="cb2-78"><a href="重點回顧.html#cb2-78" tabindex="-1"></a>  <span class="fu">count</span>(line, word, views, timestamp, likes) <span class="sc">%&gt;%</span>  <span class="co"># 計算每行每個單詞的頻率</span></span>
<span id="cb2-79"><a href="重點回顧.html#cb2-79" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(word, line, n)                      <span class="co"># 計算 TF-IDF</span></span>
<span id="cb2-80"><a href="重點回顧.html#cb2-80" tabindex="-1"></a></span>
<span id="cb2-81"><a href="重點回顧.html#cb2-81" tabindex="-1"></a></span>
<span id="cb2-82"><a href="重點回顧.html#cb2-82" tabindex="-1"></a><span class="co"># 查看結果</span></span>
<span id="cb2-83"><a href="重點回顧.html#cb2-83" tabindex="-1"></a><span class="fu">head</span>(wordfile_with_tfidf)</span></code></pre></div>
</div>
<div id="變數修正時間按讚數" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> 變數修正（時間&amp;按讚數）<a href="重點回顧.html#變數修正時間按讚數" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="重點回顧.html#cb3-1" tabindex="-1"></a><span class="co"># 創建清理 timestamp 的函數</span></span>
<span id="cb3-2"><a href="重點回顧.html#cb3-2" tabindex="-1"></a>clean_timestamp <span class="ot">&lt;-</span> <span class="cf">function</span>(timestamp) {</span>
<span id="cb3-3"><a href="重點回顧.html#cb3-3" tabindex="-1"></a>  <span class="co"># 移除 &quot;(已編輯)&quot; 的內容</span></span>
<span id="cb3-4"><a href="重點回顧.html#cb3-4" tabindex="-1"></a>  timestamp <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">(已編輯</span><span class="sc">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>, timestamp)</span>
<span id="cb3-5"><a href="重點回顧.html#cb3-5" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="重點回顧.html#cb3-6" tabindex="-1"></a>  <span class="co"># 處理不同的時間單位，並轉換為天數</span></span>
<span id="cb3-7"><a href="重點回顧.html#cb3-7" tabindex="-1"></a>  timestamp_days <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb3-8"><a href="重點回顧.html#cb3-8" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;年前&quot;</span>, timestamp),</span>
<span id="cb3-9"><a href="重點回顧.html#cb3-9" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;年前&quot;</span>, <span class="st">&quot;&quot;</span>, timestamp)) <span class="sc">*</span> <span class="dv">365</span>,  <span class="co"># 年轉換為天</span></span>
<span id="cb3-10"><a href="重點回顧.html#cb3-10" tabindex="-1"></a>    <span class="fu">ifelse</span>(</span>
<span id="cb3-11"><a href="重點回顧.html#cb3-11" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;個月前&quot;</span>, timestamp),</span>
<span id="cb3-12"><a href="重點回顧.html#cb3-12" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;個月前&quot;</span>, <span class="st">&quot;&quot;</span>, timestamp)) <span class="sc">*</span> <span class="dv">30</span>,  <span class="co"># 月轉換為天</span></span>
<span id="cb3-13"><a href="重點回顧.html#cb3-13" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb3-14"><a href="重點回顧.html#cb3-14" tabindex="-1"></a>        <span class="fu">grepl</span>(<span class="st">&quot;週前&quot;</span>, timestamp),</span>
<span id="cb3-15"><a href="重點回顧.html#cb3-15" tabindex="-1"></a>        <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;週前&quot;</span>, <span class="st">&quot;&quot;</span>, timestamp)) <span class="sc">*</span> <span class="dv">7</span>,  <span class="co"># 週轉換為天</span></span>
<span id="cb3-16"><a href="重點回顧.html#cb3-16" tabindex="-1"></a>        <span class="fu">ifelse</span>(</span>
<span id="cb3-17"><a href="重點回顧.html#cb3-17" tabindex="-1"></a>          <span class="fu">grepl</span>(<span class="st">&quot;天前&quot;</span>, timestamp),</span>
<span id="cb3-18"><a href="重點回顧.html#cb3-18" tabindex="-1"></a>          <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;天前&quot;</span>, <span class="st">&quot;&quot;</span>, timestamp)),  <span class="co"># 天保持不變</span></span>
<span id="cb3-19"><a href="重點回顧.html#cb3-19" tabindex="-1"></a>          <span class="dv">0</span>  <span class="co"># 無法識別的時間，預設為 0</span></span>
<span id="cb3-20"><a href="重點回顧.html#cb3-20" tabindex="-1"></a>        )</span>
<span id="cb3-21"><a href="重點回顧.html#cb3-21" tabindex="-1"></a>      )</span>
<span id="cb3-22"><a href="重點回顧.html#cb3-22" tabindex="-1"></a>    )</span>
<span id="cb3-23"><a href="重點回顧.html#cb3-23" tabindex="-1"></a>  )</span>
<span id="cb3-24"><a href="重點回顧.html#cb3-24" tabindex="-1"></a>  </span>
<span id="cb3-25"><a href="重點回顧.html#cb3-25" tabindex="-1"></a>  <span class="fu">return</span>(timestamp_days)</span>
<span id="cb3-26"><a href="重點回顧.html#cb3-26" tabindex="-1"></a>}</span>
<span id="cb3-27"><a href="重點回顧.html#cb3-27" tabindex="-1"></a></span>
<span id="cb3-28"><a href="重點回顧.html#cb3-28" tabindex="-1"></a></span>
<span id="cb3-29"><a href="重點回顧.html#cb3-29" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-30"><a href="重點回顧.html#cb3-30" tabindex="-1"></a></span>
<span id="cb3-31"><a href="重點回顧.html#cb3-31" tabindex="-1"></a><span class="co"># 將 timestamp 轉換為統一的天數</span></span>
<span id="cb3-32"><a href="重點回顧.html#cb3-32" tabindex="-1"></a>wordfile_with_tfidf <span class="ot">&lt;-</span> wordfile_with_tfidf <span class="sc">%&gt;%</span></span>
<span id="cb3-33"><a href="重點回顧.html#cb3-33" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-34"><a href="重點回顧.html#cb3-34" tabindex="-1"></a>    <span class="at">timestamp_days =</span> <span class="fu">clean_timestamp</span>(timestamp)  <span class="co"># 新增統一格式的天數欄位</span></span>
<span id="cb3-35"><a href="重點回顧.html#cb3-35" tabindex="-1"></a>  )</span>
<span id="cb3-36"><a href="重點回顧.html#cb3-36" tabindex="-1"></a></span>
<span id="cb3-37"><a href="重點回顧.html#cb3-37" tabindex="-1"></a></span>
<span id="cb3-38"><a href="重點回顧.html#cb3-38" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-39"><a href="重點回顧.html#cb3-39" tabindex="-1"></a></span>
<span id="cb3-40"><a href="重點回顧.html#cb3-40" tabindex="-1"></a><span class="co"># 檢查哪些值轉換後是 NA</span></span>
<span id="cb3-41"><a href="重點回顧.html#cb3-41" tabindex="-1"></a>problematic_likes <span class="ot">&lt;-</span> wordfile_with_tfidf <span class="sc">%&gt;%</span></span>
<span id="cb3-42"><a href="重點回顧.html#cb3-42" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;萬&quot;</span>, <span class="st">&quot;&quot;</span>, likes)))) <span class="sc">%&gt;%</span></span>
<span id="cb3-43"><a href="重點回顧.html#cb3-43" tabindex="-1"></a>  <span class="fu">select</span>(likes) <span class="sc">%&gt;%</span></span>
<span id="cb3-44"><a href="重點回顧.html#cb3-44" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb3-45"><a href="重點回顧.html#cb3-45" tabindex="-1"></a></span>
<span id="cb3-46"><a href="重點回顧.html#cb3-46" tabindex="-1"></a>wordfile_with_tfidf <span class="ot">&lt;-</span> wordfile_with_tfidf <span class="sc">%&gt;%</span></span>
<span id="cb3-47"><a href="重點回顧.html#cb3-47" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likes =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-48"><a href="重點回顧.html#cb3-48" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">d+(</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+)?萬$&quot;</span>, likes) <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;萬&quot;</span>, <span class="st">&quot;&quot;</span>, likes)) <span class="sc">*</span> <span class="dv">10000</span>, <span class="co"># 處理「X萬」格式</span></span>
<span id="cb3-49"><a href="重點回顧.html#cb3-49" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">d+$&quot;</span>, likes) <span class="sc">~</span> <span class="fu">as.numeric</span>(likes),                                   <span class="co"># 處理純數字</span></span>
<span id="cb3-50"><a href="重點回顧.html#cb3-50" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>                                                              <span class="co"># 其他情況設為 NA</span></span>
<span id="cb3-51"><a href="重點回顧.html#cb3-51" tabindex="-1"></a>  ))</span>
<span id="cb3-52"><a href="重點回顧.html#cb3-52" tabindex="-1"></a></span>
<span id="cb3-53"><a href="重點回顧.html#cb3-53" tabindex="-1"></a></span>
<span id="cb3-54"><a href="重點回顧.html#cb3-54" tabindex="-1"></a><span class="co"># 檢查轉換後的結果</span></span>
<span id="cb3-55"><a href="重點回顧.html#cb3-55" tabindex="-1"></a><span class="fu">head</span>(wordfile_with_tfidf<span class="sc">$</span>likes)</span>
<span id="cb3-56"><a href="重點回顧.html#cb3-56" tabindex="-1"></a></span>
<span id="cb3-57"><a href="重點回顧.html#cb3-57" tabindex="-1"></a></span>
<span id="cb3-58"><a href="重點回顧.html#cb3-58" tabindex="-1"></a></span>
<span id="cb3-59"><a href="重點回顧.html#cb3-59" tabindex="-1"></a><span class="co"># 假設 wordfile_with_tfidf 已經存在於 R 環境中</span></span>
<span id="cb3-60"><a href="重點回顧.html#cb3-60" tabindex="-1"></a>output_path <span class="ot">&lt;-</span> <span class="st">&quot;/Users/liam/Desktop/NTNU/碩二/1131/文字探勘/wordfile_with_tfidf.csv&quot;</span></span>
<span id="cb3-61"><a href="重點回顧.html#cb3-61" tabindex="-1"></a></span>
<span id="cb3-62"><a href="重點回顧.html#cb3-62" tabindex="-1"></a><span class="co"># 將資料框寫入 CSV 檔案</span></span>
<span id="cb3-63"><a href="重點回顧.html#cb3-63" tabindex="-1"></a><span class="fu">write.csv</span>(wordfile_with_tfidf, <span class="at">file =</span> output_path, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-64"><a href="重點回顧.html#cb3-64" tabindex="-1"></a></span>
<span id="cb3-65"><a href="重點回顧.html#cb3-65" tabindex="-1"></a><span class="co"># 確認輸出</span></span>
<span id="cb3-66"><a href="重點回顧.html#cb3-66" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;檔案已輸出至：&quot;</span>, output_path)</span></code></pre></div>
</div>
<div id="轉換寬格式的必要" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> 轉換寬格式的必要？<a href="重點回顧.html#轉換寬格式的必要" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="重點回顧.html#cb4-1" tabindex="-1"></a><span class="co"># 載入套件</span></span>
<span id="cb4-2"><a href="重點回顧.html#cb4-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-3"><a href="重點回顧.html#cb4-3" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb4-4"><a href="重點回顧.html#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="重點回顧.html#cb4-5" tabindex="-1"></a><span class="co"># 讀取資料</span></span>
<span id="cb4-6"><a href="重點回顧.html#cb4-6" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;/Users/liam/Desktop/NTNU/碩二/1131/文字探勘/wordfile_with_tfidf.csv&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-7"><a href="重點回顧.html#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="重點回顧.html#cb4-8" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="重點回顧.html#cb4-9" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">line_id =</span> line)</span>
<span id="cb4-10"><a href="重點回顧.html#cb4-10" tabindex="-1"></a></span>
<span id="cb4-11"><a href="重點回顧.html#cb4-11" tabindex="-1"></a><span class="co"># 資料預處理</span></span>
<span id="cb4-12"><a href="重點回顧.html#cb4-12" tabindex="-1"></a>data<span class="sc">$</span>line_id <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>line_id)</span>
<span id="cb4-13"><a href="重點回顧.html#cb4-13" tabindex="-1"></a>data<span class="sc">$</span>word <span class="ot">&lt;-</span> <span class="fu">as.character</span>(data<span class="sc">$</span>word)</span>
<span id="cb4-14"><a href="重點回顧.html#cb4-14" tabindex="-1"></a></span>
<span id="cb4-15"><a href="重點回顧.html#cb4-15" tabindex="-1"></a><span class="co"># 將資料轉換為寬格式（詞彙矩陣）</span></span>
<span id="cb4-16"><a href="重點回顧.html#cb4-16" tabindex="-1"></a>tf_idf_matrix <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb4-17"><a href="重點回顧.html#cb4-17" tabindex="-1"></a>  <span class="fu">select</span>(line_id, word, tf_idf) <span class="sc">%&gt;%</span></span>
<span id="cb4-18"><a href="重點回顧.html#cb4-18" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb4-19"><a href="重點回顧.html#cb4-19" tabindex="-1"></a>    <span class="at">names_from =</span> word,</span>
<span id="cb4-20"><a href="重點回顧.html#cb4-20" tabindex="-1"></a>    <span class="at">values_from =</span> tf_idf,</span>
<span id="cb4-21"><a href="重點回顧.html#cb4-21" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="fu">list</span>(<span class="at">tf_idf =</span> <span class="dv">0</span>)</span>
<span id="cb4-22"><a href="重點回顧.html#cb4-22" tabindex="-1"></a>  )</span>
<span id="cb4-23"><a href="重點回顧.html#cb4-23" tabindex="-1"></a></span>
<span id="cb4-24"><a href="重點回顧.html#cb4-24" tabindex="-1"></a><span class="co"># 提取每則留言的其他特徵</span></span>
<span id="cb4-25"><a href="重點回顧.html#cb4-25" tabindex="-1"></a>other_features <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb4-26"><a href="重點回顧.html#cb4-26" tabindex="-1"></a>  <span class="fu">group_by</span>(line_id) <span class="sc">%&gt;%</span></span>
<span id="cb4-27"><a href="重點回顧.html#cb4-27" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb4-28"><a href="重點回顧.html#cb4-28" tabindex="-1"></a>    <span class="at">views =</span> <span class="fu">first</span>(views),</span>
<span id="cb4-29"><a href="重點回顧.html#cb4-29" tabindex="-1"></a>    <span class="at">likes =</span> <span class="fu">first</span>(likes),</span>
<span id="cb4-30"><a href="重點回顧.html#cb4-30" tabindex="-1"></a>    <span class="at">timestamp =</span> <span class="fu">first</span>(timestamp),</span>
<span id="cb4-31"><a href="重點回顧.html#cb4-31" tabindex="-1"></a>    <span class="at">timestamp_days =</span> <span class="fu">first</span>(timestamp_days)</span>
<span id="cb4-32"><a href="重點回顧.html#cb4-32" tabindex="-1"></a>  )</span>
<span id="cb4-33"><a href="重點回顧.html#cb4-33" tabindex="-1"></a></span>
<span id="cb4-34"><a href="重點回顧.html#cb4-34" tabindex="-1"></a><span class="co"># 合併詞彙矩陣與其他特徵</span></span>
<span id="cb4-35"><a href="重點回顧.html#cb4-35" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> tf_idf_matrix <span class="sc">%&gt;%</span></span>
<span id="cb4-36"><a href="重點回顧.html#cb4-36" tabindex="-1"></a>  <span class="fu">left_join</span>(other_features, <span class="at">by =</span> <span class="st">&quot;line_id&quot;</span>)</span>
<span id="cb4-37"><a href="重點回顧.html#cb4-37" tabindex="-1"></a></span>
<span id="cb4-38"><a href="重點回顧.html#cb4-38" tabindex="-1"></a><span class="co"># 處理缺失值</span></span>
<span id="cb4-39"><a href="重點回顧.html#cb4-39" tabindex="-1"></a>final_data<span class="sc">$</span>likes[<span class="fu">is.na</span>(final_data<span class="sc">$</span>likes)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-40"><a href="重點回顧.html#cb4-40" tabindex="-1"></a></span>
<span id="cb4-41"><a href="重點回顧.html#cb4-41" tabindex="-1"></a></span>
<span id="cb4-42"><a href="重點回顧.html#cb4-42" tabindex="-1"></a></span>
<span id="cb4-43"><a href="重點回顧.html#cb4-43" tabindex="-1"></a><span class="co"># 设置观看次数的上限</span></span>
<span id="cb4-44"><a href="重點回顧.html#cb4-44" tabindex="-1"></a>upper_limit <span class="ot">&lt;-</span> <span class="dv">10000000</span>  <span class="co"># 1000 万</span></span>
<span id="cb4-45"><a href="重點回顧.html#cb4-45" tabindex="-1"></a><span class="co"># 对观看次数进行截断</span></span>
<span id="cb4-46"><a href="重點回顧.html#cb4-46" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb4-47"><a href="重點回顧.html#cb4-47" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">views_capped =</span> <span class="fu">ifelse</span>(views <span class="sc">&gt;</span> upper_limit, upper_limit, views))</span>
<span id="cb4-48"><a href="重點回顧.html#cb4-48" tabindex="-1"></a><span class="co"># 过滤数据</span></span>
<span id="cb4-49"><a href="重點回顧.html#cb4-49" tabindex="-1"></a>final_data_filtered <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb4-50"><a href="重點回顧.html#cb4-50" tabindex="-1"></a>  <span class="fu">filter</span>(views <span class="sc">&lt;=</span> upper_limit)</span>
<span id="cb4-51"><a href="重點回顧.html#cb4-51" tabindex="-1"></a></span>
<span id="cb4-52"><a href="重點回顧.html#cb4-52" tabindex="-1"></a><span class="co"># 檢視最終的資料集</span></span>
<span id="cb4-53"><a href="重點回顧.html#cb4-53" tabindex="-1"></a><span class="fu">head</span>(final_data)</span></code></pre></div>
</div>
<div id="ml-model-selection" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> ML model selection<a href="重點回顧.html#ml-model-selection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="重點回顧.html#cb5-1" tabindex="-1"></a><span class="do">#######################################################</span></span>
<span id="cb5-2"><a href="重點回顧.html#cb5-2" tabindex="-1"></a><span class="do">## 長格式資料、不tune</span></span>
<span id="cb5-3"><a href="重點回顧.html#cb5-3" tabindex="-1"></a><span class="do">#######################################################</span></span>
<span id="cb5-4"><a href="重點回顧.html#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="重點回顧.html#cb5-5" tabindex="-1"></a><span class="co"># 載入必要的套件</span></span>
<span id="cb5-6"><a href="重點回顧.html#cb5-6" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-7"><a href="重點回顧.html#cb5-7" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb5-8"><a href="重點回顧.html#cb5-8" tabindex="-1"></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb5-9"><a href="重點回顧.html#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="重點回顧.html#cb5-10" tabindex="-1"></a><span class="co"># 假設您的資料已讀取，並命名為 data</span></span>
<span id="cb5-11"><a href="重點回顧.html#cb5-11" tabindex="-1"></a><span class="co"># 資料包含以下欄位：line_id, word, views, timestamp, likes, n, tf, idf, tf_idf, timestamp_days</span></span>
<span id="cb5-12"><a href="重點回顧.html#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="重點回顧.html#cb5-13" tabindex="-1"></a><span class="co"># 定義觀看次數的區間和對應的分類</span></span>
<span id="cb5-14"><a href="重點回顧.html#cb5-14" tabindex="-1"></a>recode_views <span class="ot">&lt;-</span> <span class="cf">function</span>(views) {</span>
<span id="cb5-15"><a href="重點回顧.html#cb5-15" tabindex="-1"></a>  <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">500000</span> <span class="sc">&amp;</span> views <span class="sc">&lt;</span> <span class="dv">1000000</span>) {</span>
<span id="cb5-16"><a href="重點回顧.html#cb5-16" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span>)</span>
<span id="cb5-17"><a href="重點回顧.html#cb5-17" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">1000000</span> <span class="sc">&amp;</span> views <span class="sc">&lt;</span> <span class="dv">2000000</span>) {</span>
<span id="cb5-18"><a href="重點回顧.html#cb5-18" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">2</span>)</span>
<span id="cb5-19"><a href="重點回顧.html#cb5-19" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">2000000</span> <span class="sc">&amp;</span> views <span class="sc">&lt;</span> <span class="dv">4000000</span>) {</span>
<span id="cb5-20"><a href="重點回顧.html#cb5-20" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">3</span>)</span>
<span id="cb5-21"><a href="重點回顧.html#cb5-21" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">4000000</span> <span class="sc">&amp;</span> views <span class="sc">&lt;</span> <span class="dv">5000000</span>) {</span>
<span id="cb5-22"><a href="重點回顧.html#cb5-22" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">4</span>)</span>
<span id="cb5-23"><a href="重點回顧.html#cb5-23" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">5000000</span> <span class="sc">&amp;</span> views <span class="sc">&lt;</span> <span class="dv">6000000</span>) {</span>
<span id="cb5-24"><a href="重點回顧.html#cb5-24" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">5</span>)</span>
<span id="cb5-25"><a href="重點回顧.html#cb5-25" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">7000000</span> <span class="sc">&amp;</span> views <span class="sc">&lt;</span> <span class="dv">8000000</span>) {</span>
<span id="cb5-26"><a href="重點回顧.html#cb5-26" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">6</span>)</span>
<span id="cb5-27"><a href="重點回顧.html#cb5-27" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">8000000</span> <span class="sc">&amp;</span> views <span class="sc">&lt;</span> <span class="dv">9000000</span>) {</span>
<span id="cb5-28"><a href="重點回顧.html#cb5-28" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">7</span>)</span>
<span id="cb5-29"><a href="重點回顧.html#cb5-29" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">9000000</span> <span class="sc">&amp;</span> views <span class="sc">&lt;</span> <span class="dv">10000000</span>) {</span>
<span id="cb5-30"><a href="重點回顧.html#cb5-30" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">8</span>)</span>
<span id="cb5-31"><a href="重點回顧.html#cb5-31" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">10000000</span> <span class="sc">&amp;</span> views <span class="sc">&lt;</span> <span class="dv">15000000</span>) {</span>
<span id="cb5-32"><a href="重點回顧.html#cb5-32" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">9</span>)</span>
<span id="cb5-33"><a href="重點回顧.html#cb5-33" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (views <span class="sc">&gt;=</span> <span class="dv">15000000</span>) {</span>
<span id="cb5-34"><a href="重點回顧.html#cb5-34" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">10</span>)</span>
<span id="cb5-35"><a href="重點回顧.html#cb5-35" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-36"><a href="重點回顧.html#cb5-36" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb5-37"><a href="重點回顧.html#cb5-37" tabindex="-1"></a>  }</span>
<span id="cb5-38"><a href="重點回顧.html#cb5-38" tabindex="-1"></a>}</span>
<span id="cb5-39"><a href="重點回顧.html#cb5-39" tabindex="-1"></a></span>
<span id="cb5-40"><a href="重點回顧.html#cb5-40" tabindex="-1"></a><span class="co"># 應用編碼函數並移除缺失值</span></span>
<span id="cb5-41"><a href="重點回顧.html#cb5-41" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb5-42"><a href="重點回顧.html#cb5-42" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">views_category =</span> <span class="fu">sapply</span>(views, recode_views)) <span class="sc">%&gt;%</span></span>
<span id="cb5-43"><a href="重點回顧.html#cb5-43" tabindex="-1"></a>  <span class="fu">drop_na</span>(views_category) <span class="sc">%&gt;%</span></span>
<span id="cb5-44"><a href="重點回顧.html#cb5-44" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">views_category =</span> <span class="fu">factor</span>(views_category))  <span class="co"># 將目標變數轉換為因子</span></span>
<span id="cb5-45"><a href="重點回顧.html#cb5-45" tabindex="-1"></a></span>
<span id="cb5-46"><a href="重點回顧.html#cb5-46" tabindex="-1"></a><span class="co"># 處理數值型特徵，將 likes 和 timestamp_days 轉換為數值型，並處理缺失值</span></span>
<span id="cb5-47"><a href="重點回顧.html#cb5-47" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb5-48"><a href="重點回顧.html#cb5-48" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-49"><a href="重點回顧.html#cb5-49" tabindex="-1"></a>    <span class="at">likes =</span> <span class="fu">as.numeric</span>(likes),</span>
<span id="cb5-50"><a href="重點回顧.html#cb5-50" tabindex="-1"></a>    <span class="at">likes =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(likes), <span class="dv">0</span>, likes),</span>
<span id="cb5-51"><a href="重點回顧.html#cb5-51" tabindex="-1"></a>    <span class="at">timestamp_days =</span> <span class="fu">as.numeric</span>(timestamp_days),</span>
<span id="cb5-52"><a href="重點回顧.html#cb5-52" tabindex="-1"></a>    <span class="at">timestamp_days =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(timestamp_days), <span class="dv">0</span>, timestamp_days)</span>
<span id="cb5-53"><a href="重點回顧.html#cb5-53" tabindex="-1"></a>  )</span>
<span id="cb5-54"><a href="重點回顧.html#cb5-54" tabindex="-1"></a></span>
<span id="cb5-55"><a href="重點回顧.html#cb5-55" tabindex="-1"></a><span class="co"># 分割資料（確保每個 line_id 只出現在訓練或測試集之一）</span></span>
<span id="cb5-56"><a href="重點回顧.html#cb5-56" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb5-57"><a href="重點回顧.html#cb5-57" tabindex="-1"></a>line_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>line_id)</span>
<span id="cb5-58"><a href="重點回顧.html#cb5-58" tabindex="-1"></a>train_ids <span class="ot">&lt;-</span> <span class="fu">sample</span>(line_ids, <span class="at">size =</span> <span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">length</span>(line_ids))</span>
<span id="cb5-59"><a href="重點回顧.html#cb5-59" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(line_id <span class="sc">%in%</span> train_ids)</span>
<span id="cb5-60"><a href="重點回顧.html#cb5-60" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>line_id <span class="sc">%in%</span> train_ids)</span>
<span id="cb5-61"><a href="重點回顧.html#cb5-61" tabindex="-1"></a></span>
<span id="cb5-62"><a href="重點回顧.html#cb5-62" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
<span id="cb5-63"><a href="重點回顧.html#cb5-63" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(tf, idf, timestamp, views))</span>
<span id="cb5-64"><a href="重點回顧.html#cb5-64" tabindex="-1"></a></span>
<span id="cb5-65"><a href="重點回顧.html#cb5-65" tabindex="-1"></a></span>
<span id="cb5-66"><a href="重點回顧.html#cb5-66" tabindex="-1"></a>ml_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(views_category <span class="sc">~</span> word , <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb5-67"><a href="重點回顧.html#cb5-67" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb5-68"><a href="重點回顧.html#cb5-68" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb5-69"><a href="重點回顧.html#cb5-69" tabindex="-1"></a></span>
<span id="cb5-70"><a href="重點回顧.html#cb5-70" tabindex="-1"></a></span>
<span id="cb5-71"><a href="重點回顧.html#cb5-71" tabindex="-1"></a>ml_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(views_category <span class="sc">~</span> word <span class="sc">+</span> tf_idf , <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb5-72"><a href="重點回顧.html#cb5-72" tabindex="-1"></a>  <span class="co"># 移除不必要的欄位（若有）</span></span>
<span id="cb5-73"><a href="重點回顧.html#cb5-73" tabindex="-1"></a>  <span class="fu">step_other</span>(word, <span class="at">threshold =</span> <span class="fl">0.01</span>) <span class="sc">%&gt;%</span>       <span class="co"># 將出現頻率低於1%的詞彙歸類為 &quot;other&quot;</span></span>
<span id="cb5-74"><a href="重點回顧.html#cb5-74" tabindex="-1"></a>  <span class="fu">step_dummy</span>(word) <span class="sc">%&gt;%</span>                         <span class="co"># 將 &#39;word&#39; 轉換為虛擬變數</span></span>
<span id="cb5-75"><a href="重點回顧.html#cb5-75" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())    <span class="co"># 標準化數值型預測變數</span></span>
<span id="cb5-76"><a href="重點回顧.html#cb5-76" tabindex="-1"></a></span>
<span id="cb5-77"><a href="重點回顧.html#cb5-77" tabindex="-1"></a><span class="co"># 檢查配方是否正確</span></span>
<span id="cb5-78"><a href="重點回顧.html#cb5-78" tabindex="-1"></a><span class="fu">prep</span>(ml_recipe, <span class="at">training =</span> train_data) <span class="sc">%&gt;%</span> <span class="fu">juice</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb5-79"><a href="重點回顧.html#cb5-79" tabindex="-1"></a></span>
<span id="cb5-80"><a href="重點回顧.html#cb5-80" tabindex="-1"></a><span class="co"># 建立模型規格（未調參）</span></span>
<span id="cb5-81"><a href="重點回顧.html#cb5-81" tabindex="-1"></a>lasso_spec <span class="ot">&lt;-</span> <span class="fu">multinom_reg</span>(<span class="at">penalty =</span> <span class="fl">0.1</span>, <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># LASSO 邏輯回歸</span></span>
<span id="cb5-82"><a href="重點回顧.html#cb5-82" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb5-83"><a href="重點回顧.html#cb5-83" tabindex="-1"></a></span>
<span id="cb5-84"><a href="重點回顧.html#cb5-84" tabindex="-1"></a>svm_spec <span class="ot">&lt;-</span> <span class="fu">svm_linear</span>(<span class="at">cost =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>                        <span class="co"># 線性 SVM</span></span>
<span id="cb5-85"><a href="重點回顧.html#cb5-85" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-86"><a href="重點回顧.html#cb5-86" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;LiblineaR&quot;</span>)</span>
<span id="cb5-87"><a href="重點回顧.html#cb5-87" tabindex="-1"></a></span>
<span id="cb5-88"><a href="重點回顧.html#cb5-88" tabindex="-1"></a>null_spec <span class="ot">&lt;-</span> <span class="fu">null_model</span>() <span class="sc">%&gt;%</span>                               <span class="co"># Null 模型</span></span>
<span id="cb5-89"><a href="重點回顧.html#cb5-89" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-90"><a href="重點回顧.html#cb5-90" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;parsnip&quot;</span>)</span>
<span id="cb5-91"><a href="重點回顧.html#cb5-91" tabindex="-1"></a></span>
<span id="cb5-92"><a href="重點回顧.html#cb5-92" tabindex="-1"></a><span class="co"># 建立工作流程</span></span>
<span id="cb5-93"><a href="重點回顧.html#cb5-93" tabindex="-1"></a>lasso_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-94"><a href="重點回顧.html#cb5-94" tabindex="-1"></a>  <span class="fu">add_recipe</span>(ml_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb5-95"><a href="重點回顧.html#cb5-95" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_spec)</span>
<span id="cb5-96"><a href="重點回顧.html#cb5-96" tabindex="-1"></a></span>
<span id="cb5-97"><a href="重點回顧.html#cb5-97" tabindex="-1"></a>svm_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-98"><a href="重點回顧.html#cb5-98" tabindex="-1"></a>  <span class="fu">add_recipe</span>(ml_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb5-99"><a href="重點回顧.html#cb5-99" tabindex="-1"></a>  <span class="fu">add_model</span>(svm_spec)</span>
<span id="cb5-100"><a href="重點回顧.html#cb5-100" tabindex="-1"></a></span>
<span id="cb5-101"><a href="重點回顧.html#cb5-101" tabindex="-1"></a>null_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-102"><a href="重點回顧.html#cb5-102" tabindex="-1"></a>  <span class="fu">add_recipe</span>(ml_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb5-103"><a href="重點回顧.html#cb5-103" tabindex="-1"></a>  <span class="fu">add_model</span>(null_spec)</span>
<span id="cb5-104"><a href="重點回顧.html#cb5-104" tabindex="-1"></a></span>
<span id="cb5-105"><a href="重點回顧.html#cb5-105" tabindex="-1"></a><span class="co"># 訓練模型</span></span>
<span id="cb5-106"><a href="重點回顧.html#cb5-106" tabindex="-1"></a>final_lasso_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(lasso_workflow, <span class="at">data =</span> train_data)</span>
<span id="cb5-107"><a href="重點回顧.html#cb5-107" tabindex="-1"></a>final_svm_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(svm_workflow, <span class="at">data =</span> train_data)</span>
<span id="cb5-108"><a href="重點回顧.html#cb5-108" tabindex="-1"></a>final_null_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(null_workflow, <span class="at">data =</span> train_data)</span>
<span id="cb5-109"><a href="重點回顧.html#cb5-109" tabindex="-1"></a></span>
<span id="cb5-110"><a href="重點回顧.html#cb5-110" tabindex="-1"></a><span class="co"># 預測與評估</span></span>
<span id="cb5-111"><a href="重點回顧.html#cb5-111" tabindex="-1"></a></span>
<span id="cb5-112"><a href="重點回顧.html#cb5-112" tabindex="-1"></a><span class="co"># 定義評估指標</span></span>
<span id="cb5-113"><a href="重點回顧.html#cb5-113" tabindex="-1"></a>eval_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy, kap, roc_auc)</span>
<span id="cb5-114"><a href="重點回顧.html#cb5-114" tabindex="-1"></a></span>
<span id="cb5-115"><a href="重點回顧.html#cb5-115" tabindex="-1"></a><span class="co"># LASSO 模型評估</span></span>
<span id="cb5-116"><a href="重點回顧.html#cb5-116" tabindex="-1"></a>lasso_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_lasso_fit, test_data, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-117"><a href="重點回顧.html#cb5-117" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(final_lasso_fit, test_data)) <span class="sc">%&gt;%</span></span>
<span id="cb5-118"><a href="重點回顧.html#cb5-118" tabindex="-1"></a>  <span class="fu">bind_cols</span>(test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(views_category))</span>
<span id="cb5-119"><a href="重點回顧.html#cb5-119" tabindex="-1"></a></span>
<span id="cb5-120"><a href="重點回顧.html#cb5-120" tabindex="-1"></a>lasso_metrics <span class="ot">&lt;-</span> lasso_predictions <span class="sc">%&gt;%</span></span>
<span id="cb5-121"><a href="重點回顧.html#cb5-121" tabindex="-1"></a>  <span class="fu">eval_metrics</span>(<span class="at">truth =</span> views_category, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb5-122"><a href="重點回顧.html#cb5-122" tabindex="-1"></a></span>
<span id="cb5-123"><a href="重點回顧.html#cb5-123" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;LASSO 模型評估結果：&quot;</span>)</span>
<span id="cb5-124"><a href="重點回顧.html#cb5-124" tabindex="-1"></a><span class="fu">print</span>(lasso_metrics)</span>
<span id="cb5-125"><a href="重點回顧.html#cb5-125" tabindex="-1"></a></span>
<span id="cb5-126"><a href="重點回顧.html#cb5-126" tabindex="-1"></a><span class="co"># SVM 模型評估</span></span>
<span id="cb5-127"><a href="重點回顧.html#cb5-127" tabindex="-1"></a>svm_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_svm_fit, test_data, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-128"><a href="重點回顧.html#cb5-128" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(final_svm_fit, test_data)) <span class="sc">%&gt;%</span></span>
<span id="cb5-129"><a href="重點回顧.html#cb5-129" tabindex="-1"></a>  <span class="fu">bind_cols</span>(test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(views_category))</span>
<span id="cb5-130"><a href="重點回顧.html#cb5-130" tabindex="-1"></a></span>
<span id="cb5-131"><a href="重點回顧.html#cb5-131" tabindex="-1"></a>svm_metrics <span class="ot">&lt;-</span> svm_predictions <span class="sc">%&gt;%</span></span>
<span id="cb5-132"><a href="重點回顧.html#cb5-132" tabindex="-1"></a>  <span class="fu">eval_metrics</span>(<span class="at">truth =</span> views_category, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb5-133"><a href="重點回顧.html#cb5-133" tabindex="-1"></a></span>
<span id="cb5-134"><a href="重點回顧.html#cb5-134" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;SVM 模型評估結果：&quot;</span>)</span>
<span id="cb5-135"><a href="重點回顧.html#cb5-135" tabindex="-1"></a><span class="fu">print</span>(svm_metrics)</span>
<span id="cb5-136"><a href="重點回顧.html#cb5-136" tabindex="-1"></a></span>
<span id="cb5-137"><a href="重點回顧.html#cb5-137" tabindex="-1"></a><span class="co"># Null 模型評估</span></span>
<span id="cb5-138"><a href="重點回顧.html#cb5-138" tabindex="-1"></a>null_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_null_fit, test_data) <span class="sc">%&gt;%</span></span>
<span id="cb5-139"><a href="重點回顧.html#cb5-139" tabindex="-1"></a>  <span class="fu">bind_cols</span>(test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(views_category))</span>
<span id="cb5-140"><a href="重點回顧.html#cb5-140" tabindex="-1"></a></span>
<span id="cb5-141"><a href="重點回顧.html#cb5-141" tabindex="-1"></a>null_metrics <span class="ot">&lt;-</span> null_predictions <span class="sc">%&gt;%</span></span>
<span id="cb5-142"><a href="重點回顧.html#cb5-142" tabindex="-1"></a>  <span class="fu">eval_metrics</span>(<span class="at">truth =</span> views_category, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb5-143"><a href="重點回顧.html#cb5-143" tabindex="-1"></a></span>
<span id="cb5-144"><a href="重點回顧.html#cb5-144" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Null 模型評估結果：&quot;</span>)</span>
<span id="cb5-145"><a href="重點回顧.html#cb5-145" tabindex="-1"></a><span class="fu">print</span>(null_metrics)</span>
<span id="cb5-146"><a href="重點回顧.html#cb5-146" tabindex="-1"></a></span>
<span id="cb5-147"><a href="重點回顧.html#cb5-147" tabindex="-1"></a><span class="co"># 合併所有模型的評估結果</span></span>
<span id="cb5-148"><a href="重點回顧.html#cb5-148" tabindex="-1"></a>all_metrics <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb5-149"><a href="重點回顧.html#cb5-149" tabindex="-1"></a>  lasso_metrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;LASSO&quot;</span>),</span>
<span id="cb5-150"><a href="重點回顧.html#cb5-150" tabindex="-1"></a>  svm_metrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;SVM&quot;</span>),</span>
<span id="cb5-151"><a href="重點回顧.html#cb5-151" tabindex="-1"></a>  null_metrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;Null Model&quot;</span>)</span>
<span id="cb5-152"><a href="重點回顧.html#cb5-152" tabindex="-1"></a>)</span>
<span id="cb5-153"><a href="重點回顧.html#cb5-153" tabindex="-1"></a></span>
<span id="cb5-154"><a href="重點回顧.html#cb5-154" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;所有模型的評估結果：&quot;</span>)</span>
<span id="cb5-155"><a href="重點回顧.html#cb5-155" tabindex="-1"></a><span class="fu">print</span>(all_metrics)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="next-step.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
